(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{244:function(e,t,n){e.exports=n(428)},249:function(e,t,n){},428:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(29),s=n.n(r),c=n(15),i=n(6),l=n(231),u=(n(249),n(23)),d=n(24),p=n(27),m=n(26),h=n(28),b=n(19),f=n(20),v=n(436),g=n(438),k=n(439),O=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o))))._closeModal=function(){n.props.appStore.closeGenotypeModal()},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.appStore;return o.a.createElement(v.a,{open:e.showGenotypeModal,"data-testid":"genotype-modal"},o.a.createElement(v.a.Header,null,"Genotype of scanned pot number"),o.a.createElement(v.a.Content,null,e.errorMessage?o.a.createElement(g.a,{color:"red",icon:"times circle outline",content:e.errorMessage}):o.a.createElement(o.a.Fragment,null,o.a.createElement("h4",null,"pot: ",e.scannedGenotype.POT),o.a.createElement("h2",null,"genotype: ",e.scannedGenotype.GENOTYPE))),o.a.createElement(v.a.Actions,null,o.a.createElement(k.a,{onClick:this._closeModal,"data-testid":"genotype-modal-close-button",color:"blue"},"close")))}}]),t}(a.Component),y=Object(c.b)("appStore")(Object(c.c)(O)),E=n(105),C=Object(c.b)("appStore")(Object(c.c)(function(e){var t=e.appStore,n=Object(E.a)(Array(t.lookupAssemblyCounter%5+1).keys());return o.a.createElement(v.a,{open:t.isBuildingLookup,"data-testid":"lookup-assembly-modal"},o.a.createElement(v.a.Header,null,"Building lookup table..."),o.a.createElement(v.a.Content,null,t.lookupAssemblyError?o.a.createElement(g.a,{color:"red","data-testid":"lookup-error-message"},"Could not assemble lookup table!"):o.a.createElement(o.a.Fragment,null,n.map(function(e,t){return o.a.createElement("span",{key:"".concat(t,"-carrot"),role:"img","aria-label":"carrot","data-testid":"carrot"},"\ud83e\udd55"," ")}))),t.lookupAssemblyError?o.a.createElement(v.a.Actions,null,o.a.createElement(k.a,{primary:!0,onClick:function(){return t.assembleLookupForMode()},"data-testid":"lookup-error-retry-button"},"retry")):null)})),M=n(210);function S(){var e=Object(b.a)(["\n  z-index: 10;\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 40px;\n  color: white;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]);return S=function(){return e},e}var j=f.a.div(S()),w=Object(c.b)("appStore")(Object(c.c)(function(e){var t=e.appStore,n=t.activeMode,a=t.numberOfCrosses,r=t.afterScanning;return o.a.createElement(j,null,o.a.createElement("span",null,n.name," - ",a," ",o.a.createElement(M.a,{name:"see"===r?"eye":"save"})))})),A=Object(c.b)("appStore")(Object(c.c)(function(e){var t=e.appStore,n=t.errorMessage,a=t.successMessage;return o.a.createElement("div",null,n?o.a.createElement(g.a,{color:"red",icon:"times circle outline",content:n,"data-testid":"queue-feedback-error"}):null,a?o.a.createElement(g.a,{color:"green",icon:"check circle outline",content:a,"data-testid":"queue-feedback-success"}):null)})),T=n(435);function L(){var e=Object(b.a)(["\n  font-weight: bold;\n"]);return L=function(){return e},e}function P(){var e=Object(b.a)(["\n  flex: 1;\n"]);return P=function(){return e},e}function I(){var e=Object(b.a)(["\n  display: flex;\n  padding: 1rem 0;\n"]);return I=function(){return e},e}var G=f.a.div(I()),Q=f.a.div(P()),N=Object(f.a)(Q)(L()),x=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.appStore,t=e.scannedCodes,n=e.numberOfCrosses;return o.a.createElement(o.a.Fragment,null,o.a.createElement(G,null,o.a.createElement(N,null,"step"),o.a.createElement(N,null,"Pot number"),o.a.createElement(N,null,"Sterility")),Object(E.a)(Array(n).keys()).map(function(n,a){var r=t.length>a?t[a]:{},s=r.potNumber,c=r.sterile;return o.a.createElement(G,{key:"scan-".concat(a)},o.a.createElement(Q,null,a+1),o.a.createElement(Q,null,s||"-"),o.a.createElement(Q,null,o.a.createElement(T.a,{"data-testid":"sterility-toggle",toggle:!0,onChange:function(){return e.toggleSterility(a)},checked:c,disabled:![!0,!1].includes(c)})))}))}}]),t}(a.Component),B=Object(c.b)("appStore")(Object(c.c)(x));function R(){var e=Object(b.a)(["\n  flex: 1;\n"]);return R=function(){return e},e}function _(){var e=Object(b.a)(["\n  display: flex;\n  margin-bottom: 1rem;\n"]);return _=function(){return e},e}var F=f.a.div(_()),D=f.a.div(R()),q=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o))))._closeModal=function(){n.props.appStore.closeQueueModal()},n._clearQueue=function(){n.props.appStore.clearQueue()},n._proceed=function(){n.props.appStore.nextOrSave()},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.appStore;return o.a.createElement(v.a,{open:e.showQueueModal,"data-testid":"queue-modal"},o.a.createElement(v.a.Header,null,"Scan Queue"),o.a.createElement(v.a.Content,null,o.a.createElement(A,null),o.a.createElement(B,null)),o.a.createElement(v.a.Actions,null,o.a.createElement(F,null,o.a.createElement(k.a,{onClick:this._closeModal,"data-testid":"queue-modal-close-button"},"close"),o.a.createElement(D,null),o.a.createElement(k.a,{onClick:this._clearQueue,color:"red","data-testid":"queue-modal-discard-button",disabled:e.discardButtonDisabled},"discard"),o.a.createElement(k.a,{onClick:this._proceed,color:"green","data-testid":"queue-modal-confirm-button",content:e.saveButtonText,loading:e.isLoading}))))}}]),t}(a.Component),K=Object(c.b)("appStore")(Object(c.c)(q));function Y(){var e=Object(b.a)(["\n  margin-right: 0px !important;\n"]);return Y=function(){return e},e}function z(){var e=Object(b.a)(["\n  background: transparent;\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  padding: 1rem;\n"]);return z=function(){return e},e}var H=f.a.div(z()),U=Object(f.a)(k.a)(Y()),W=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o))))._openQueueModal=function(){n.props.appStore.openQueueModal()},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(H,null,o.a.createElement(U,{icon:"inbox","data-testid":"queue-button",onClick:this._openQueueModal,size:"massive",color:"green"})),o.a.createElement(K,null))}}]),t}(a.Component),J=Object(c.b)("appStore")(Object(c.c)(W));function $(){var e=Object(b.a)(["\n  height: calc(100%);\n  width: 100vw;\n\n  > video {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n"]);return $=function(){return e},e}var Z=f.a.div($()),V=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(m.a)(t).call(this,e)))._startScanner=function(){n.props.appStore.initializeScanner(n.videoRef)},n.videoRef=o.a.createRef(),n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this._startScanner()}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(Z,null,o.a.createElement("video",{ref:this.videoRef,playsInline:!0})))}}]),t}(a.Component),X=Object(c.b)("appStore")(Object(c.c)(V)),ee=n(440),te=n(437);function ne(){var e=Object(b.a)(["\n  background: transparent;\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  padding: 1rem;\n"]);return ne=function(){return e},e}var ae=f.a.div(ne()),oe=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o))))._toggleSettingsModal=function(){n.props.appStore.toggleSettingsModal()},n._setActiveModeName=function(e,t){var a=t.value;n.props.appStore.setActiveMode(a)},n._setCamera=function(e,t){var a=t.value;n.props.appStore.changeCamera(a)},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.appStore,t=e.cameras.map(function(e){return{text:e.name,value:e.id}});return o.a.createElement(o.a.Fragment,null,o.a.createElement(ae,null,o.a.createElement(k.a,{icon:"setting","data-testid":"settings-button",onClick:this._toggleSettingsModal,size:"massive",color:"pink"})),o.a.createElement(v.a,{open:e.showSettingsModal,"data-testid":"settings-modal"},o.a.createElement(v.a.Header,null,"Settings"),o.a.createElement(v.a.Content,null,o.a.createElement(ee.a,{as:"h3"},"After Scanning..."),o.a.createElement(k.a.Group,null,o.a.createElement(k.a,{icon:"save",content:"save",active:"save"===e.afterScanning,onClick:function(){return e.toggleAfterScanning()}}),o.a.createElement(k.a,{icon:"eye",content:"see",active:"see"===e.afterScanning,onClick:function(){return e.toggleAfterScanning()}})),o.a.createElement(ee.a,{as:"h3"},"Mode"),o.a.createElement(k.a.Group,null,e.modes.map(function(t,n){return o.a.createElement(k.a,{key:"mode-".concat(n),active:t.name===e.activeMode.name,onClick:function(){return e.setActiveMode(t.name)},"data-testid":"mode-switch-button"},t.name)})),o.a.createElement(ee.a,{as:"h3"},"Number of crosses"),o.a.createElement(k.a.Group,null,e.crosses.map(function(t,n){return o.a.createElement(k.a,{key:"cross-".concat(t),active:t===e.numberOfCrosses,onClick:function(){return e.setNumberOfCrosses(t)},"data-testid":"crosses-switch-button"},t)})),o.a.createElement(ee.a,{as:"h3"},"Camera"),e.cameras.length?o.a.createElement(te.a,{"data-testid":"camera-select",options:t,selection:!0,fluid:!0,onChange:this._setCamera,value:e.activeCamera?e.activeCamera.id:"",text:e.activeCamera?e.activeCamera.name:""}):o.a.createElement("p",null,"No cameras... is the site loaded via https?")),o.a.createElement(v.a.Actions,null,o.a.createElement(k.a,{primary:!0,onClick:this._toggleSettingsModal,"data-testid":"settings-modal-save"},"ok"))))}}]),t}(a.Component),re=Object(c.b)("appStore")(Object(c.c)(oe));function se(){var e=Object(b.a)(["\n  height: ","px;\n  width: 100vw;\n  overflow: hidden;\n  position: relative;\n"]);return se=function(){return e},e}var ce=f.a.div(se(),window.innerHeight),ie=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return o.a.createElement(ce,null,o.a.createElement(w,null),o.a.createElement(X,null),o.a.createElement(re,null),o.a.createElement(J,null),o.a.createElement(C,null),o.a.createElement(y,null))}}]),t}(a.Component),le=Object(c.b)("appStore")(Object(c.c)(ie));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ue=/^([0-9]{4})$/,de=n(233),pe=window.Airtable;pe.configure({endpointUrl:"https://api.airtable.com",apiKey:"key5ofWaqgEdz6Lku"});var me=pe.base("appfg7BuOITypaNZN"),he=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(u.a)(this,e),this.showQueueModal=!1,this.modes=[],this.crosses=[],this.showSettingsModal=!1,this.cameras=[],this.scannedCodes=[],this.errorMessage="",this.successMessage="",this.isLoading=!1,this.afterScanning="save",this.showGenotypeModal=!1,this.scannedGenotype={},this.isBuildingLookup=!1,this.lookupAssemblyError=!1,this.lookupAssemblyCounter=0,this.lookup={},this._determinMirroring=function(){return window.innerWidth>1024},this.modes=t,this.crosses=n,this.activeMode=t[0],this.numberOfCrosses=n[0],this.assembleLookupForMode()}return Object(d.a)(e,[{key:"toggleAfterScanning",value:function(){"see"===this.afterScanning?this.afterScanning="save":this.afterScanning="see"}},{key:"closeGenotypeModal",value:function(){this.showGenotypeModal=!1,this.errorMessage=""}},{key:"startLookupAssembly",value:function(){var e=this;this.lookupAssemblyError=!1,this.isBuildingLookup=!0,this.lookupAssemblyInterval=setInterval(function(){return Object(i.m)(function(){return e.lookupAssemblyCounter+=1})},1e3)}},{key:"stopLookupAssembly",value:function(){this.isBuildingLookup=!1,clearInterval(this.lookupAssemblyInterval),this.lookupAssemblyCounter=0}},{key:"assembleLookupForMode",value:function(){var e=this;this.activeMode.lookupTable.table&&!Object.keys(this.lookup).includes(this.activeMode.lookupTable.table)&&(Object(i.m)(function(){return e.startLookupAssembly()}),function(e,t,n){var a={};return new Promise(function(o,r){me(e).select({fields:n}).eachPage(function(e,n){e.forEach(function(e){var n=e.get(t),o=e.id,r=Object(de.a)({},e.fields,{id:o});a[n]=r}),n()},function(e){e&&r(e),o(a)})})}(this.activeMode.lookupTable.table,this.activeMode.lookupTable.lookupKey,this.activeMode.lookupTable.fields).then(function(t){Object(i.m)(function(){return e.lookup[e.activeMode.lookupTable.table]=t}),Object(i.m)(function(){return e.stopLookupAssembly()})}).catch(function(t){t?Object(i.m)(function(){e.lookupAssemblyError=!0,clearInterval(e.lookupAssemblyInterval),e.lookupAssemblyCounter=0}):Object(i.m)(function(){e.stopLookupAssembly()})}))}},{key:"setActiveMode",value:function(e){var t=this.modes.find(function(t){return t.name===e});this.activeMode=t,this.clearQueue()}},{key:"setNumberOfCrosses",value:function(e){this.numberOfCrosses=e,this.clearQueue()}},{key:"toggleSettingsModal",value:function(){this.showSettingsModal=!this.showSettingsModal,this.showSettingsModal||this.assembleLookupForMode()}},{key:"setCameras",value:function(e){this.cameras=e,this.activeCamera=e[0]}},{key:"initializeScanner",value:function(e){var t=this,n=new window.Instascan.Scanner({video:e.current,mirror:t._determinMirroring()});t.scanner=n,t.scanner.addListener("scan",function(e){t.handleContent(e)}),window.Instascan.Camera.getCameras().then(function(e){e.length>0?(t.setCameras(e),t.scanner.start(t.activeCamera)):console.error("No cameras found.")}).catch(function(e){console.error(e)})}},{key:"handleContent",value:function(e){if(this.errorMessage="",!this.showQueueModal){var t=function(e){var t=ue.exec(e);return t&&t[1]?t[1]:null}(e);if("see"===this.afterScanning){var n=this.lookup[this.activeMode.lookupTable.table][t];return n?this.scannedGenotype=n||{}:this.errorMessage="".concat("Pot number not found in lookup table:"," ").concat(t),void(this.showGenotypeModal=!0)}if(this.showQueueModal=!0,t)this.lookup[this.activeMode.lookupTable.table][t]?this.scannedCodes.push({potNumber:t,sterile:!1}):(this.scannedContent=e,this.errorMessage="".concat("Pot number not found in lookup table:"," ").concat(t));else this.scannedContent=e,this.errorMessage="Pot number not found in QR code"}}},{key:"toggleSterility",value:function(e){var t=this.scannedCodes[e];t.sterile=!t.sterile}},{key:"changeCamera",value:function(e){var t=this,n=this.cameras.find(function(t){return t.id===e});this.scanner.stop().then(function(){t.scanner.start(n),Object(i.m)(function(){t.activeCamera=n})})}},{key:"setActiveCamera",value:function(e){this.activeCamera=e}},{key:"openQueueModal",value:function(){this.showQueueModal=!0}},{key:"closeQueueModal",value:function(){this.showQueueModal=!1,this.errorMessage="",this.successMessage=""}},{key:"clearQueue",value:function(){this.scannedCodes=[],this.errorMessage="",this.successMessage=""}},{key:"nextOrSave",value:function(){this.scannedCodes.length<this.numberOfCrosses?this.closeQueueModal():this.postScannedCodes()}},{key:"airtablePostSuccess",value:function(e){var t=e.fields.NUMBER;this.isLoading=!1,this.scannedCodes=[],this.successMessage="Entry saved with number ".concat(t,". Good luck!")}},{key:"airtablePostError",value:function(e){this.isLoading=!1,this.errorMessage=e}},{key:"postScannedCodes",value:function(){var e,t,n,a,o,r,s,c,l=this,u=this.activeMode;Object(i.m)(function(){return l.isLoading=!0}),e=[this.lookup[this.activeMode.lookupTable.table][this.scannedCodes[0].potNumber].id],o=this.scannedCodes[0].sterile?"S":"F";try{t=[this.lookup[this.activeMode.lookupTable.table][this.scannedCodes[1].potNumber].id]}catch(h){t=[]}try{r=this.scannedCodes[1].sterile?"S":"F"}catch(h){r=null}try{n=[this.lookup[this.activeMode.lookupTable.table][this.scannedCodes[2].potNumber].id]}catch(h){n=[]}try{s=this.scannedCodes[2].sterile?"S":"F"}catch(h){s=null}try{a=[this.lookup[this.activeMode.lookupTable.table][this.scannedCodes[3].potNumber].id]}catch(h){a=[]}try{c=this.scannedCodes[3].sterile?"S":"F"}catch(h){c=null}var d,p,m={"DATE OF CROSS":(new Date).toISOString(),"POT ID 1":e,"POT ID 2":t,"POT ID 3":n,"POT ID 4":a,"STERILITY 1":o,"STERILITY 2":r,"STERILITY 3":s,"STERILITY 4":c};(d=u.table,p=m,new Promise(function(e,t){me(d).create(p,function(n,a){n?t(n):e(a)})})).then(function(e){return l.airtablePostSuccess(e)}).catch(function(e){return l.airtablePostError(e.message)})}},{key:"discardButtonDisabled",get:function(){return!this.scannedCodes.length||this.isLoading}},{key:"saveButtonText",get:function(){return this.scannedCodes.length===this.numberOfCrosses?"save":"next"}}]),e}();Object(i.g)(he,{modes:i.l,crosses:i.l,activeMode:i.l,numberOfCrosses:i.l,showSettingsModal:i.l,cameras:i.l,activeCamera:i.l,scanner:i.l,showQueueModal:i.l,scannedContent:i.l,scannedCodes:i.l,successMessage:i.l,errorMessage:i.l,isLoading:i.l,afterScanning:i.l,showGenotypeModal:i.l,scannedGenotype:i.l,isBuildingLookup:i.l,lookupAssemblyCounter:i.l,lookupAssemblyError:i.l,lookup:i.l,assembleLookupForMode:i.d,setActiveMode:i.d,setNumberOfCrosses:i.d,toggleSettingsModal:i.d,setCameras:i.d,setActiveCamera:i.d,changeCamera:i.d,initializeScanner:i.d,openQueueModal:i.d,closeQueueModal:i.d,clearQueue:i.d,handleContent:i.d,nextOrSave:i.d,postScannedCodes:i.d,airtablePostSuccess:i.d,airtablePostError:i.d,startLookupAssembly:i.d,stopLookupAssembly:i.d,toggleSterility:i.d,toggleAfterScanning:i.d,closeGenotypeModal:i.d});var be=new he([{name:"Scott",lookupTable:{table:"CARROT LOOKUP",fields:["POT","GENOTYPE"],lookupKey:"POT"},table:"SCOTT BREEDING"},{name:"Carrots",lookupTable:{table:"CARROT LOOKUP",fields:["POT","GENOTYPE"],lookupKey:"POT"},table:"CARROT BREEDING"},{name:"Beets",lookupTable:{table:"BEET LOOKUP",fields:["POT","GENOTYPE"],lookupKey:"POT"},table:"BEET BREEDING"}],[1,2,3,4]),fe=be;window.appStore=be,l.init({dsn:"https://21fe5a20a1fa4e5ba8fee26ec9cec189@sentry.io/1380593"}),Object(i.e)({enforceActions:"always"});var ve={appStore:fe};s.a.render(o.a.createElement(c.a,ve,o.a.createElement(le,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[244,2,1]]]);
//# sourceMappingURL=main.64d642a3.chunk.js.map